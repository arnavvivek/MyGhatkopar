<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyGhatkopar</title>
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icons/icon-512.png" />

  <style>
    :root {
      --bg:#0b1220; --bg-soft:#0f172a; --card:#0f172a; --card-2:#111827;
      --text:#e5e7eb; --muted:#94a3b8; --border:#1f2937; --ring:#22d3ee;
      --emergency:#ef4444; --approval:#3b82f6; --notice:#f59e0b; --sos:#10b981;
      --radius:16px;
    }
    .light {
      --bg:#f6f7fb; --bg-soft:#f1f5f9; --card:#ffffff; --card-2:#ffffff;
      --text:#0f172a; --muted:#475569; --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:linear-gradient(180deg,var(--bg) 0%, var(--bg-soft) 100%); color:var(--text);
      padding-bottom:84px;
    }
    header{
      position:sticky; top:0; z-index:20; backdrop-filter: blur(8px);
      background:linear-gradient(180deg, rgba(15,23,42,.9) 0%, rgba(15,23,42,.6) 100%);
      border-bottom:1px solid var(--border);
      padding:12px 16px;
    }
    .light header{ background:linear-gradient(180deg, rgba(255,255,255,.9) 0%, rgba(255,255,255,.7) 100%); }
    .topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;}
    .title{display:flex;gap:10px;align-items:center;font-weight:800}
    .title .app{
      padding:6px 10px;border-radius:999px;background:#0ea5e922;color:#22d3ee;border:1px solid #155e75;
      font-size:12px; letter-spacing:.3px;
    }
    .actions{display:flex;gap:8px;align-items:center;}
    .iconbtn{
      border:1px solid var(--border); background:transparent; color:var(--text);
      padding:8px 10px;border-radius:12px; cursor:pointer;
    }
    .searchrow{display:flex;gap:8px;margin-top:10px}
    .searchrow input, .searchrow select, .searchrow select#lang {
      flex:1; padding:11px 12px; border-radius:14px; border:1px solid var(--border);
      background:var(--card); color:var(--text);
    }
    .searchrow select#lang{flex:0 0 160px}
    .chips{display:flex; gap:8px; overflow:auto; padding:8px 0 2px 0}
    .chip{
      padding:8px 12px; border-radius:999px; border:1px solid var(--border);
      background:var(--card-2); color:var(--text); font-size:13px; white-space:nowrap; cursor:pointer;
    }
    .chip.active{ outline:2px solid var(--ring); }
    main{padding:16px; display:grid; gap:12px; max-width:900px; margin:0 auto;}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      padding:14px; box-shadow: 0 10px 30px rgba(0,0,0,.12);
      animation: rise .35s ease both;
    }
    @keyframes rise{ from{opacity:0; transform: translateY(8px)} to{opacity:1; transform:none} }
    .card h3{margin:6px 0 8px; font-size:1rem}
    .meta{font-size:12px;color:var(--muted); margin-bottom:6px; display:flex; gap:10px; flex-wrap:wrap}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; color:#0b1220}
    .badge.emergency{background: #fecaca;}
    .badge.approvals{background:#bfdbfe;}
    .badge.notices{background:#fde68a;}
    .badge.sos{background:#bbf7d0;}
    .actions-row{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .btn{padding:8px 12px; border-radius:12px; border:1px solid var(--border); background:var(--card-2); color:var(--text); cursor:pointer; font-size:13px; text-decoration:none; display:inline-block}
    .btn.primary{ background:#0ea5e9; color:#00111a; border:none; }
    .btn.call{ background: #10b981; color:#00110a; border:none; }
    .empty{opacity:.7; text-align:center; padding:40px 10px}
    .bottomnav{
      position:fixed; left:0; right:0; bottom:0; height:72px; display:flex; gap:6px; justify-content:space-around; align-items:center;
      background:linear-gradient(180deg, rgba(15,23,42,.85) 0%, rgba(15,23,42,.95) 100%);
      border-top:1px solid var(--border); z-index:30;
    }
    .light .bottomnav{ background:linear-gradient(180deg, rgba(255,255,255,.85) 0%, rgba(255,255,255,.95) 100%); }
    .navbtn{
      display:flex; flex-direction:column; align-items:center; gap:4px; font-size:12px; color:#cbd5e1; background:transparent; border:none; cursor:pointer;
    }
    .light .navbtn{ color:#334155; }
    .navbtn.active{ color:#22d3ee; font-weight:700 }
    .install-tip{ position:fixed; bottom:84px; right:16px; background:#0ea5e9; color:#06232c; padding:10px 12px; border-radius:12px; font-size:12px; display:none }
    .hidden{display:none}
    a.link{color:#38bdf8; text-decoration:none}
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="title">
        <img src="icons/icon-192.png" alt="app" width="28" height="28" style="border-radius:8px;box-shadow:0 0 0 1px var(--border)" />
        <div>
          <div id="appName">MyGhatkopar</div>
          <div class="app" id="appTag">Community updates тАв Offline</div>
        </div>
      </div>
      <div class="actions">
        <select id="lang" aria-label="Language">
          <option value="en">English</option>
          <option value="hi">рд╣рд┐рдиреНрджреА</option>
          <option value="mr">рдорд░рд╛рдареА</option>
        </select>
        <button id="darkToggle" class="iconbtn" title="Toggle Dark">ЁЯМЩ</button>
        <button id="shareApp" class="iconbtn" title="Share App">ЁЯФЧ</button>
      </div>
    </div>

    <div class="searchrow">
      <input id="search" placeholder="Search updates e.g. water cut, fire, metro..." />
      <select id="sort" aria-label="Sort">
        <option value="new">Newest</option>
        <option value="old">Oldest</option>
      </select>
    </div>

    <div class="chips" id="chips">
      <div class="chip active" data-section="all">All</div>
      <div class="chip" data-section="emergency">ЁЯЪи Emergency</div>
      <div class="chip" data-section="approvals">ЁЯПЫ Approvals</div>
      <div class="chip" data-section="notices">ЁЯУв Notices</div>
      <div class="chip" data-section="sos">тШО SOS</div>
    </div>
  </header>

  <main id="list" aria-live="polite"></main>

  <div class="install-tip" id="installTip">Tap Menu тЛо тЖТ Add to Home screen</div>

  <nav class="bottomnav" role="navigation" aria-label="Bottom">
    <button class="navbtn active" data-section="all">ЁЯПа <span id="navHome">Home</span></button>
    <button class="navbtn" data-section="emergency">ЁЯЪи <span id="navEmergency">Emergency</span></button>
    <button class="navbtn" data-section="approvals">ЁЯПЫ <span id="navApprovals">Approvals</span></button>
    <button class="navbtn" data-section="notices">ЁЯУв <span id="navNotices">Notices</span></button>
    <button class="navbtn" data-section="sos">тШО <span id="navSOS">SOS</span></button>
  </nav>

  <script>
    // ---------- PWA registration ----------
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(()=>{});
    }

    // ---------- i18n strings ----------
    const t = {
      en: {
        appName: "MyGhatkopar",
        appTag: "Community updates тАв Offline",
        searchPH: "Search updates e.g. water cut, fire, metro...",
        tabs: {all:"All", emergency:"ЁЯЪи Emergency", approvals:"ЁЯПЫ Approvals", notices:"ЁЯУв Notices", sos:"тШО SOS"},
        nav: {home:"Home", emergency:"Emergency", approvals:"Approvals", notices:"Notices", sos:"SOS"},
        share: "Share", map: "Map", call: "Call", altCall: "Alt Call",
        empty: "No updates."
      },
      hi: {
        appName: "рдорд╛рдп рдШрд╛рдЯрдХреЛрдкрд░",
        appTag: "рд╕рдореБрджрд╛рдп рдЕрдкрдбреЗрдЯ тАв рдСрдлрд╝рд▓рд╛рдЗрди",
        searchPH: "рдЦреЛрдЬреЗрдВ: рдкрд╛рдиреА рдХрдЯ, рдЖрдЧ, рдореЗрдЯреНрд░реЛ...",
        tabs: {all:"рд╕рднреА", emergency:"ЁЯЪи рдЖрдкрд╛рддрдХрд╛рд▓", approvals:"ЁЯПЫ рдЕрдиреБрдореЛрджрди", notices:"ЁЯУв рдиреЛрдЯрд┐рд╕", sos:"тШО рдЖрдкрд╛рдд рд╕рд╣рд╛рдпрддрд╛"},
        nav: {home:"рд╣реЛрдо", emergency:"рдЖрдкрд╛рддрдХрд╛рд▓", approvals:"рдЕрдиреБрдореЛрджрди", notices:"рдиреЛрдЯрд┐рд╕", sos:"рдЖрдкрд╛рдд"},
        share: "рд╢реЗрдпрд░", map: "рдорд╛рдирдЪрд┐рддреНрд░", call: "рдХреЙрд▓", altCall: "рд╡реИрдХрд▓реНрдкрд┐рдХ рдХреЙрд▓",
        empty: "рдХреЛрдИ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ."
      },
      mr: {
        appName: "рдорд╛рдп рдШрд╛рдЯрдХреЛрдкрд░",
        appTag: "рд╕рдореБрджрд╛рдп рдЕрджреНрдпрддрди тАв рдСрдлрд▓рд╛рдЗрди",
        searchPH: "рд╢реЛрдзрд╛: рдкрд╛рдгреА рдХрдкрд╛рдд, рдЖрдЧ, рдореЗрдЯреНрд░реЛ...",
        tabs: {all:"рд╕рд░реНрд╡", emergency:"ЁЯЪи рдЖрдкрддреНрдХрд╛рд▓", approvals:"ЁЯПЫ рдорд╛рдиреНрдпрддрд╛", notices:"ЁЯУв рд╕реВрдЪрдирд╛", sos:"тШО рдЖрдкрддреНрдХрд╛рд▓реАрди"},
        nav: {home:"рдореБрдЦреНрдп", emergency:"рдЖрдкрддреНрдХрд╛рд▓", approvals:"рдорд╛рдиреНрдпрддрд╛", notices:"рд╕реВрдЪрдирд╛", sos:"рдЖрдкрддреНрдХрд╛рд▓реАрди"},
        share: "рд╢реЗрдЕрд░", map: "рдирдХрд╛рд╢рд╛", call: "рдХреЙрд▓", altCall: "рдкрд░реНрдпрд╛рдпреА рдХреЙрд▓",
        empty: "рдХреЛрдгрддреЗрд╣реА рдЕрджреНрдпрддрди рдирд╛рд╣реА."
      }
    };

    // ---------- Demo data (localized titles/descriptions; phone links always work) ----------
    const data = {
      en: [
        {id:1,type:'emergency',title:'Minor fire near R City Mall',details:'Fire brigade contained a small blaze near service lane. No casualties.',area:'LBS Marg, Amrut Nagar (W)',when:new Date().toISOString()},
        {id:2,type:'emergency',title:'Waterlogging on Station Road',details:'Traffic diverted via Tilak Road; expect delays.',area:'Ghatkopar East',when:new Date(Date.now()-3600e3).toISOString()},
        {id:3,type:'approvals',title:'90 Feet Road widening sanctioned',details:'Phase-wise expansion approved to ease congestion.',area:'Ghatkopar East',when:'2025-08-20T10:00:00'},
        {id:4,type:'approvals',title:'Footpath improvements approved',details:'Ramps and tiling near Pant Nagar market.',area:'Pant Nagar',when:'2025-08-18T09:30:00'},
        {id:5,type:'notices',title:'Water cut tomorrow 10:00тАУ16:00',details:'Valve replacement; store water in advance.',area:'Pant Nagar, Garodia Nagar',when:'2025-08-26T10:00:00'},
        {id:6,type:'notices',title:'Planned power maintenance 14:00тАУ16:00',details:'Elevators may be unavailable.',area:'Ghatkopar West',when:'2025-08-27T14:00:00'},
        {id:7,type:'sos',title:'Rajawadi Hospital тАУ Emergency',details:'24├Ч7 casualty.',area:'Ghatkopar East',when:new Date().toISOString(),phone:'+912225115066',link:'https://maps.google.com/?q=Rajawadi+Hospital+Ghatkopar'},
        {id:8,type:'sos',title:'Pant Nagar Police Station',details:'Police assistance.',area:'Pant Nagar',when:new Date().toISOString(),phone:'+912225013624',phone2:'+912221028914',link:'https://maps.google.com/?q=Pant+Nagar+Police+Station+Ghatkopar'},
        {id:9,type:'sos',title:'Fire Brigade (Mumbai Control Room)',details:'City fire emergency.',area:'Citywide',when:new Date().toISOString(),phone:'101',phone2:'+912223076111'},
        {id:10,type:'sos',title:'Ambulance (108)',details:'State emergency ambulance service.',area:'Citywide',when:new Date().toISOString(),phone:'108'}
      ],
      hi: [
        {id:1,type:'emergency',title:'рдЖрд░ рд╕рд┐рдЯреА рдореЙрд▓ рдХреЗ рдкрд╛рд╕ рдорд╛рдореВрд▓реА рдЖрдЧ',details:'рдлрд╛рдпрд░ рдмреНрд░рд┐рдЧреЗрдб рдиреЗ рдЖрдЧ рдкрд░ рдХрд╛рдмреВ рдкрд╛ рд▓рд┐рдпрд╛ред рдХреЛрдИ рд╣рддрд╛рд╣рдд рдирд╣реАрдВред',area:'рдПрд▓рдмреАрдПрд╕ рдорд╛рд░реНрдЧ, рдЕрдореГрдд рдирдЧрд░ (рдк.)',when:new Date().toISOString()},
        {id:2,type:'emergency',title:'рд╕реНрдЯреЗрд╢рди рд░реЛрдб рдкрд░ рдкрд╛рдиреА рднрд░рд╛рд╡',details:'рдЯреНрд░реИрдлрд┐рдХ рддрд┐рд▓рдХ рд░реЛрдб рдХреА рдУрд░ рдореЛрдбрд╝рд╛ рдЧрдпрд╛ред',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдкреВ.)',when:new Date(Date.now()-3600e3).toISOString()},
        {id:3,type:'approvals',title:'90 рдлреАрдЯ рд░реЛрдб рдЪреМрдбрд╝реАрдХрд░рдг рд╕реНрд╡реАрдХреГрдд',details:'рднреАрдбрд╝ рдХрдо рдХрд░рдиреЗ рд╣реЗрддреБ рд╕реНрд╡реАрдХреГрддрд┐ред',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдкреВ.)',when:'2025-08-20T10:00:00'},
        {id:4,type:'approvals',title:'рдлреБрдЯрдкрд╛рде рд╕реБрдзрд╛рд░ рдпреЛрдЬрдирд╛',details:'рдкреЗрдВрдЯ рдирдЧрд░ рдмрд╛рдЬрд╛рд░ рдХреЗ рдкрд╛рд╕ рд░реИрдВрдк рд╡ рдЯрд╛рдЗрд▓рд┐рдВрдЧред',area:'рдкрдВрдд рдирдЧрд░',when:'2025-08-18T09:30:00'},
        {id:5,type:'notices',title:'рдХрд▓ 10:00тАУ16:00 рдкрд╛рдиреА рдмрдВрдж',details:'рд╡рд╛рд▓реНрд╡ рдмрджрд▓рдиреЗ рдХрд╛ рдХрд╛рдо; рдкрд╛рдиреА рдкрд╣рд▓реЗ рд╕реЗ рднрд░реЗрдВред',area:'рдкрдВрдд рдирдЧрд░, рдЧрд░реЛрдбрд┐рдпрд╛ рдирдЧрд░',when:'2025-08-26T10:00:00'},
        {id:6,type:'notices',title:'рдирд┐рдпреЛрдЬрд┐рдд рдмрд┐рдЬрд▓реА рдмрдВрдж 14:00тАУ16:00',details:'рд▓рд┐рдлреНрдЯ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдмрдВрдж рд░рд╣ рд╕рдХрддреА рд╣реИред',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдк.)',when:'2025-08-27T14:00:00'},
        {id:7,type:'sos',title:'рд░рд╛рдЬрд╛рд╡рд╛рдбреА рдЕрд╕реНрдкрддрд╛рд▓ тАУ рдЖрдкрд╛рдд',details:'24├Ч7 рдЖрдкрд╛рдд рд╕реЗрд╡рд╛ред',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдкреВ.)',when:new Date().toISOString(),phone:'+912225115066',link:'https://maps.google.com/?q=Rajawadi+Hospital+Ghatkopar'},
        {id:8,type:'sos',title:'рдкрдВрдд рдирдЧрд░ рдкреБрд▓рд┐рд╕ рд╕реНрдЯреЗрд╢рди',details:'рдкреБрд▓рд┐рд╕ рд╕рд╣рд╛рдпрддрд╛ред',area:'рдкрдВрдд рдирдЧрд░',when:new Date().toISOString(),phone:'+912225013624',phone2:'+912221028914',link:'https://maps.google.com/?q=Pant+Nagar+Police+Station+Ghatkopar'},
        {id:9,type:'sos',title:'рдлрд╛рдпрд░ рдмреНрд░рд┐рдЧреЗрдб (рдореБрдВрдмрдИ рдХрдВрдЯреНрд░реЛрд▓ рд░реВрдо)',details:'рд╢рд╣рд░ рдЕрдЧреНрдирд┐ рдЖрдкрд╛рддрдХрд╛рд▓ред',area:'рд╕рдореВрдЪрд╛ рд╢рд╣рд░',when:new Date().toISOString(),phone:'101',phone2:'+912223076111'},
        {id:10,type:'sos',title:'рдПрдореНрдмреБрд▓реЗрдВрд╕ (108)',details:'рд░рд╛рдЬреНрдп рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдПрдореНрдмреБрд▓реЗрдВрд╕ рд╕реЗрд╡рд╛ред',area:'рд╕рдореВрдЪрд╛ рд╢рд╣рд░',when:new Date().toISOString(),phone:'108'}
      ],
      mr: [
        {id:1,type:'emergency',title:'рдЖрд░ рд╕рд┐рдЯреА рдореЙрд▓рдЬрд╡рд│ рдХрд┐рд░рдХреЛрд│ рдЖрдЧ',details:'рдлрд╛рдпрд░ рдмреНрд░рд┐рдЧреЗрдбрдиреЗ рдЖрдЧ рд╡рд┐рдЭрд╡рд▓реА. рдХреЛрдгрддреАрд╣реА рдЬреАрд╡рд┐рддрд╣рд╛рдиреА рдирд╛рд╣реА.',area:'рдПрд▓рдмреАрдПрд╕ рдорд╛рд░реНрдЧ, рдЕрдореГрдд рдирдЧрд░ (рдк.)',when:new Date().toISOString()},
        {id:2,type:'emergency',title:'рд╕реНрдЯреЗрд╢рди рд░реЛрдбрд╡рд░ рдкрд╛рдгреА рд╕рд╛рдЪрдгреЗ',details:'рд╡рд╛рд╣рддреВрдХ рддрд┐рд▓рдХ рд░рд╕реНрддреНрдпрд╛рдХрдбреЗ рд╡рд│рд╡рд▓реА.',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдкреВ.)',when:new Date(Date.now()-3600e3).toISOString()},
        {id:3,type:'approvals',title:'90 рдлреВрдЯ рд░реЛрдб рд░реБрдВрджреАрдХрд░рдг рдордВрдЬреВрд░',details:'рд╡рд╛рд╣рддреВрдХ рдХреЛрдВрдбреА рдХрдореА рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдордВрдЬреБрд░реА.',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдкреВ.)',when:'2025-08-20T10:00:00'},
        {id:4,type:'approvals',title:'рдлреБрдЯрдкрд╛рде рд╕реБрдзрд╛рд░ рдкреНрд░рдХрд▓реНрдк',details:'рдкрдВрдд рдирдЧрд░ рдмрд╛рдЬрд╛рд░рд╛рдЬрд╡рд│ рд░реЕрдореНрдк рд╡ рдЯрд╛рдЗрд▓рд┐рдВрдЧ.',area:'рдкрдВрдд рдирдЧрд░',when:'2025-08-18T09:30:00'},
        {id:5,type:'notices',title:'рдЙрджреНрдпрд╛ 10:00тАУ16:00 рдкрд╛рдгреА рдХрдкрд╛рдд',details:'рд╡реНрд╣реЙрд▓реНрд╡ рдмрджрд▓; рдкрд╛рдгреА рд╕рд╛рдард╡рд╛.',area:'рдкрдВрдд рдирдЧрд░, рдЧрд░реЛрдбрд┐рдпрд╛ рдирдЧрд░',when:'2025-08-26T10:00:00'},
        {id:6,type:'notices',title:'рдирд┐рдпрдд рд╡реАрдЬ рджреЗрдЦрднрд╛рд▓ 14:00тАУ16:00',details:'рд▓рд┐рдлреНрдЯ рддрд╛рддреНрдкреБрд░рддреА рдмрдВрдж рдЕрд╕реВ рд╢рдХрддреЗ.',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдк.)',when:'2025-08-27T14:00:00'},
        {id:7,type:'sos',title:'рд░рд╛рдЬрд╛рд╡рд╛рдбреА рд░реБрдЧреНрдгрд╛рд▓рдп тАУ рдЖрдкрддреНрдХрд╛рд▓',details:'24├Ч7 рдЖрдкрддрдХрд╛рд▓реАрди рд╕реЗрд╡рд╛.',area:'рдШрд╛рдЯрдХреЛрдкрд░ (рдкреВ.)',when:new Date().toISOString(),phone:'+912225115066',link:'https://maps.google.com/?q=Rajawadi+Hospital+Ghatkopar'},
        {id:8,type:'sos',title:'рдкрдВрдд рдирдЧрд░ рдкреЛрд▓реАрд╕ рдард╛рдгреЗ',details:'рдкреЛрд▓реАрд╕ рдорджрдд.',area:'рдкрдВрдд рдирдЧрд░',when:new Date().toISOString(),phone:'+912225013624',phone2:'+912221028914',link:'https://maps.google.com/?q=Pant+Nagar+Police+Station+Ghatkopar'},
        {id:9,type:'sos',title:'рдлрд╛рдпрд░ рдмреНрд░рд┐рдЧреЗрдб (рдореБрдВрдмрдИ рдирд┐рдпрдВрддреНрд░рдг рдХрдХреНрд╖)',details:'рд╢рд╣рд░ рдЕрдЧреНрдирд┐ рдЖрдкрддреНрдХрд╛рд▓.',area:'рдореБрдВрдмрдИ',when:new Date().toISOString(),phone:'101',phone2:'+912223076111'},
        {id:10,type:'sos',title:'ре▓рдореНрдмреНрдпреБрд▓рдиреНрд╕ (108)',details:'рд░рд╛рдЬреНрдп рдЖрдкрддрдХрд╛рд▓реАрди ре▓рдореНрдмреНрдпреБрд▓рдиреНрд╕ рд╕реЗрд╡рд╛.',area:'рдореБрдВрдмрдИ',when:new Date().toISOString(),phone:'108'}
      ]
    };

    // ---------- State ----------
    const state = {
      section: 'all',
      search: '',
      sort: 'new',
      lang: localStorage.getItem('lang') || 'en',
      dark: localStorage.getItem('dark') === '1'
    };

    // ---------- Elements ----------
    const listEl = document.getElementById('list');
    const chips = document.querySelectorAll('#chips .chip');
    const navbtns = document.querySelectorAll('.navbtn');
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');
    const langSelect = document.getElementById('lang');
    const appNameEl = document.getElementById('appName');
    const appTagEl = document.getElementById('appTag');
    const darkToggle = document.getElementById('darkToggle');

    // ---------- UI helpers ----------
    const labelMap = (lng)=>({
      emergency:'ЁЯЪи ' + t[lng].tabs.emergency.replace('ЁЯЪи ',''),
      approvals:'ЁЯПЫ ' + t[lng].tabs.approvals.replace('ЁЯПЫ ',''),
      notices:'ЁЯУв ' + t[lng].tabs.notices.replace('ЁЯУв ',''),
      sos:'тШО ' + t[lng].tabs.sos.replace('тШО ',''),
    });
    function badge(type,lng){
      const m = labelMap(lng);
      return `<span class="badge ${type}">${m[type]||type}</span>`;
    }
    function iconFor(type){
      return type==='emergency'?'ЁЯЪи':type==='approvals'?'ЁЯПЧя╕П':type==='notices'?'ЁЯУв':'тШО';
    }

    function applyLang(){
      const lng = state.lang;
      langSelect.value = lng;
      appNameEl.textContent = t[lng].appName;
      appTagEl.textContent = t[lng].appTag;
      searchInput.placeholder = t[lng].searchPH;
      document.querySelector('[data-section="all"]').textContent = t[lng].tabs.all;
      document.querySelector('[data-section="emergency"]').textContent = t[lng].tabs.emergency;
      document.querySelector('[data-section="approvals"]').textContent = t[lng].tabs.approvals;
      document.querySelector('[data-section="notices"]').textContent = t[lng].tabs.notices;
      document.querySelector('[data-section="sos"]').textContent = t[lng].tabs.sos;
      document.getElementById('navHome').textContent = t[lng].nav.home;
      document.getElementById('navEmergency').textContent = t[lng].nav.emergency;
      document.getElementById('navApprovals').textContent = t[lng].nav.approvals;
      document.getElementById('navNotices').textContent = t[lng].nav.notices;
      document.getElementById('navSOS').textContent = t[lng].nav.sos;
      localStorage.setItem('lang', lng);
      render();
    }

    function applyDark(){
      document.documentElement.style.colorScheme = state.dark ? 'dark' : 'light';
      document.body.classList.toggle('light', !state.dark);
      localStorage.setItem('dark', state.dark?'1':'0');
      darkToggle.textContent = state.dark ? 'ЁЯМЩ' : 'тШАя╕П';
    }

    function render(){
      const lng = state.lang;
      let items = data[lng].slice();
      if(state.section!=='all') items = items.filter(x=>x.type===state.section);
      if(state.search) items = items.filter(x => (x.title+x.details+x.area).toLowerCase().includes(state.search.toLowerCase()));
      items.sort((a,b)=> state.sort==='new' ? (new Date(b.when)-new Date(a.when)) : (new Date(a.when)-new Date(b.when)));

      listEl.innerHTML = items.map(x => {
        const whenStr = new Date((x.when||'').toString()).toLocaleString();
        const callBtns = x.type==='sos'
          ? (x.phone?`<a class="btn call" href="tel:${x.phone}">${t[lng].call}</a>`:'') +
            (x.phone2?` <a class="btn call" href="tel:${x.phone2}">${t[lng].altCall}</a>`:'')
          : '';
        const mapBtn = x.link ? `<a class="btn" target="_blank" rel="noopener" href="${x.link}">${t[lng].map}</a>` : '';
        return `
          <article class="card">
            <div class="meta">
              <span>${whenStr}</span> <span>тАв</span> <span>${badge(x.type,lng)}</span>
            </div>
            <h3>${iconFor(x.type)} ${x.title}</h3>
            <div>${x.details}</div>
            <div class="meta">ЁЯУН ${x.area}</div>
            <div class="actions-row">
              ${callBtns}
              ${mapBtn}
              <button class="btn" onclick="share('${x.title} тАФ ${x.details}')">${t[lng].share}</button>
            </div>
          </article>
        `;
      }).join('') || `<div class="empty">${t[lng].empty}</div>`;
    }

    // ---------- Events ----------
    searchInput.addEventListener('input', (e)=>{ state.search=e.target.value.trim(); render(); });
    sortSelect.addEventListener('change', (e)=>{ state.sort=e.target.value; render(); });
    langSelect.addEventListener('change', (e)=>{ state.lang=e.target.value; applyLang(); });

    document.querySelectorAll('#chips .chip').forEach(c => c.addEventListener('click', ()=>{
      document.querySelectorAll('#chips .chip').forEach(ch => ch.classList.remove('active'));
      c.classList.add('active');
      state.section = c.dataset.section;
      navbtns.forEach(n=> n.classList.toggle('active', n.dataset.section===state.section));
      render();
    }));
    navbtns.forEach(n => n.addEventListener('click', ()=>{
      navbtns.forEach(x=>x.classList.remove('active'));
      n.classList.add('active');
      state.section = n.dataset.section;
      document.querySelectorAll('#chips .chip').forEach(ch => ch.classList.toggle('active', ch.dataset.section===state.section));
      render();
    }));

    // Share
    function share(text){
      if (navigator.share) navigator.share({title:'MyGhatkopar', text}).catch(()=>{});
      else navigator.clipboard.writeText(text);
    }
    window.share = share;

    // Dark mode
    darkToggle.addEventListener('click', ()=>{ state.dark=!state.dark; applyDark(); });

    // Before-install prompt tip
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      document.getElementById('installTip').style.display='block';
    });

    // ---------- Init ----------
    (function init(){
      // restore settings
      if(!['en','hi','mr'].includes(state.lang)) state.lang='en';
      applyDark();
      applyLang();
    })();
  </script>
</body>
</html>
